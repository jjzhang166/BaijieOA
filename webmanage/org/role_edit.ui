BjPage
{
AdjustFrame:0
BeforeCreate:""
BodyProp:""
BootstrapVer:2
Caption:编辑角色
Enabled:1
Name:BjPage1
PageID:""
ParenClass:""
Visible:1
Workflow:""
Position
{
Height:1900
Left:102
Top:86
Width:800
}
Events
{
Def:""
OnLoad:""
}
@
{
EasyScript
{
Caption:设置二级菜单
Code:"me.ControlProp[\"二级菜单/Active\"] = \"角色设置\";"
CodeType:load
Name:EasyScript1
Position
{
Height:20
Left:0
Top:-37
Width:80
}
}
UserControl
{
BeforeCreate:""
Caption:""
Enabled:1
Name:UserControl1
PathName:"/template/webmanagetemp.ui"
Visible:1
Position
{
Height:1607
Left:45
Top:34
Width:831
}
@
{
Box
{
AfterCreate:""
BeforeCreate:""
Caption:""
Enabled:1
ExtProp:""
ID:""
Name:SettingClient
TagName:""
Visible:1
Position
{
Height:1429
Left:18
Top:23
Width:757
}
@
{
BjBreadcrumbNav
{
BeforeCreate:""
ExtProp:""
Name:BjBreadcrumbNav1
Position
{
Height:52
Left:20
Top:21
Width:436
}
@
{
BjBreadcrumb
{
Active:""
BeforeCreate:""
Caption:当前位置：
Divider:""
Enabled:1
Name:BjBreadcrumb1
Visible:1
href:""
Position
{
Height:20
Left:16
Top:18
Width:80
}
}
BjBreadcrumb
{
Active:""
BeforeCreate:""
Caption:系统设置
Divider:"/"
Enabled:1
Name:BjBreadcrumb2
Visible:1
href:"<%echo(FixUrl(\"/webmanage/main.esh\"));%>"
Position
{
Height:20
Left:106
Top:18
Width:80
}
}
BjBreadcrumb
{
Active:""
BeforeCreate:""
Caption:角色设置
Divider:"/"
Enabled:1
Name:BjBreadcrumb3
Visible:1
href:"<%echo(FixUrl(\"/webmanage/org/role.esh\"));%>"
Position
{
Height:20
Left:202
Top:18
Width:80
}
}
BjBreadcrumb
{
Active:""
BeforeCreate:""
Caption:编辑角色
Divider:""
Enabled:1
Name:BjBreadcrumb4
Visible:1
href:""
Position
{
Height:20
Left:302
Top:18
Width:80
}
}
}
}
BjSubmitArea
{
Action:""
BeforeCreate:"
var oRecord = (new dao.table(\"t_role\")).Single(\"where id=?\",int(me._vo.id));
"
Caption:""
FileUpload:0
Horz:0
ID:""
Inline:0
Method:post
Name:t_role_submitarea
Search:0
Position
{
Height:1084
Left:20
Top:93
Width:681
}
@
{
EasyScript
{
Caption:""
Code:"
public var _Errort_role_Hint=\"\";
public var _Successt_role_Hint=\"\";
"
CodeType:server
Name:esvar_t_role
Position
{
Height:20
Left:10
Top:10
Width:80
}
}
ConditionControl
{
Action:"me._Errort_role_Hint <> \"\""
BeforeCreate:""
Method:if
Name:errconditiont_role
Position
{
Height:80
Left:10
Top:40
Width:338
}
@
{
BjAlertBox
{
BeforeCreate:""
CanClose:1
Caption:""
Enabled:1
ID:""
Level:error
Multi:1
Name:errAlertt_role
Visible:1
Position
{
Height:60
Left:10
Top:10
Width:300
}
@
{
Html
{
BeforeCreate:""
Caption:错误提示_t_role
Code:"<% echo(me._Errort_role_Hint); %>"
Name:errHtml_t_role
Position
{
Height:20
Left:10
Top:10
Width:80
}
}
}
}
}
}
ConditionControl
{
Action:"me._Successt_role_Hint <> \"\""
BeforeCreate:""
Method:if
Name:successconditiont_role
Position
{
Height:80
Left:10
Top:130
Width:338
}
@
{
BjAlertBox
{
BeforeCreate:""
CanClose:1
Caption:""
Enabled:1
ID:""
Level:success
Multi:1
Name:successAlertt_role
Visible:1
Position
{
Height:60
Left:10
Top:10
Width:300
}
@
{
Html
{
BeforeCreate:""
Caption:成功提示_t_role
Code:"<% echo(me._Successt_role_Hint); %>"
Name:successHtml_t_role
Position
{
Height:20
Left:10
Top:10
Width:80
}
}
}
}
}
}
BjEdit
{
BeforeCreate:""
Caption:id
Enabled:1
ID:""
Inline:0
IsMultiline:0
IsPassword:0
Name:id
PlaceHolder:""
Search:0
Size:none
Value:"<% echo( oRecord.id ); %>"
Visible:0
Wide:none
cols:0
rows:0
Position
{
Height:20
Left:100
Top:220
Width:80
}
InfoStatus
{
Condition:""
Text:""
}
WarnStatus
{
Condition:""
Text:""
}
ErrorStatus
{
Condition:""
Text:""
}
SuccessStatus
{
Condition:""
Text:""
}
Events
{
OnSearch:""
}
Validate
{
DisplayName:""
Format:""
MaxLength:0
MustFill:0
}
}
BjEdit
{
BeforeCreate:""
Caption:"roletype:"
Enabled:1
ID:""
Inline:0
IsMultiline:0
IsPassword:0
Name:roletype
PlaceHolder:""
Search:0
Size:none
Value:"<% echo(oRecord.roletype); %>"
Visible:0
Wide:none
cols:0
rows:0
Position
{
Height:20
Left:317
Top:268
Width:80
}
InfoStatus
{
Condition:""
Text:""
}
WarnStatus
{
Condition:""
Text:""
}
ErrorStatus
{
Condition:""
Text:""
}
SuccessStatus
{
Condition:""
Text:""
}
Events
{
OnSearch:""
}
Validate
{
DisplayName:""
Format:""
MaxLength:0
MustFill:0
}
}
BjEdit
{
BeforeCreate:""
Caption:角色名称：
Enabled:1
ID:""
Inline:0
IsMultiline:0
IsPassword:0
Name:name
PlaceHolder:""
Search:0
Size:none
Value:"<% echo( oRecord.name ); %>"
Visible:1
Wide:none
cols:0
rows:0
Position
{
Height:20
Left:100
Top:250
Width:80
}
InfoStatus
{
Condition:""
Text:""
}
WarnStatus
{
Condition:""
Text:""
}
ErrorStatus
{
Condition:""
Text:""
}
SuccessStatus
{
Condition:""
Text:""
}
Events
{
OnSearch:""
}
Validate
{
DisplayName:name
Format:""
MaxLength:128
MustFill:1
}
}
BjEdit
{
BeforeCreate:""
Caption:角色描述：
Enabled:1
ID:""
Inline:0
IsMultiline:1
IsPassword:0
Name:desc
PlaceHolder:""
Search:0
Size:none
Value:"<% echo( oRecord.desc ); %>"
Visible:1
Wide:none
cols:0
rows:0
Position
{
Height:20
Left:100
Top:280
Width:80
}
InfoStatus
{
Condition:""
Text:""
}
WarnStatus
{
Condition:""
Text:""
}
ErrorStatus
{
Condition:""
Text:""
}
SuccessStatus
{
Condition:""
Text:""
}
Events
{
OnSearch:""
}
Validate
{
DisplayName:desc
Format:""
MaxLength:1024
MustFill:0
}
}
BjEdit
{
BeforeCreate:""
Caption:角色类型：
Enabled:0
ID:""
Inline:0
IsMultiline:0
IsPassword:0
Name:roletype
PlaceHolder:""
Search:0
Size:none
Value:"<% echo( staticcall(\"模型.组织.角色.角色类型.Text\",oRecord.roletype ); %>"
Visible:1
Wide:none
cols:0
rows:0
Position
{
Height:20
Left:100
Top:315
Width:80
}
InfoStatus
{
Condition:""
Text:""
}
WarnStatus
{
Condition:""
Text:""
}
ErrorStatus
{
Condition:""
Text:""
}
SuccessStatus
{
Condition:""
Text:""
}
Events
{
OnSearch:""
}
Validate
{
DisplayName:""
Format:""
MaxLength:0
MustFill:0
}
}
ConditionControl
{
Action:"oRecord.roletype == const \"模型.组织.角色.角色类型.群组\""
BeforeCreate:""
Method:if
Name:ConditionControl1
Position
{
Height:157
Left:38
Top:349
Width:631
}
@
{
Box
{
AfterCreate:""
BeforeCreate:"var ids=[];
var names=[];
var aUser = (new dao.table(\"t_role_user\")).Query(
	\"select a.userid,b.alias from t_role_user a left join t_user b on a.userid = b.id where b.isdeleted=0 and a.roleid=?\",int(oRecord.id));
each(a,aUser)
{
	ids.Add(\"|\").Add(a.userid);
	if( names.Count > 0 ) names.Add(\",\");
	
	names.Add(a.alias);
}"
Caption:""
Enabled:1
ExtProp:""
ID:""
Name:Box1
TagName:""
Visible:1
Position
{
Height:126
Left:14
Top:7
Width:560
}
@
{
BjEdit
{
BeforeCreate:""
Caption:用户：
Enabled:0
ID:users
Inline:0
IsMultiline:0
IsPassword:0
Name:users
PlaceHolder:""
Search:0
Size:none
Value:"<% echo( string(names) ); %>"
Visible:1
Wide:none
cols:0
rows:0
Position
{
Height:20
Left:56
Top:13
Width:80
}
InfoStatus
{
Condition:""
Text:""
}
WarnStatus
{
Condition:""
Text:""
}
ErrorStatus
{
Condition:""
Text:""
}
SuccessStatus
{
Condition:""
Text:""
}
Events
{
OnSearch:""
}
Validate
{
DisplayName:""
Format:""
MaxLength:0
MustFill:0
}
}
BjPageCall
{
AfterCreate:""
BeforeCall:"
$(\"#input_users\").val( $(\"#users\").val() );
$(\"#input_userids\").val( $(\"#userids\").val() );"
BeforeCreate:""
CancelCall:""
Caption:""
CommitCall:"$(\"#users\").val( $(\"#input_users\").val() );
$(\"#userids\").val( $(\"#input_userids\").val() );
//document.getElementById(\"users\").value=$('#userids').val();"
Enabled:1
ExtProp:""
Name:SelectUser
TagName:span
URL:"<%echo(FixUrl(\"/iframe/selectuser.esh\"));%>"
Visible:1
Position
{
Height:100
Left:148
Top:7
Width:378
}
@
{
BjCallArg
{
ID:input_userids
IsInput:1
IsOutput:1
Name:input_userids
Value:""
Position
{
Height:28
Left:36
Top:17
Width:165
}
}
Box
{
AfterCreate:""
BeforeCreate:""
Caption:""
Enabled:1
ExtProp:"style=\"margin-top:-16px\""
ID:""
Name:Box2
TagName:span
Visible:1
Position
{
Height:60
Left:211
Top:16
Width:148
}
@
{
BjCallButton
{
AfterCreate:""
BeforeCreate:""
Caption:选择用户
Enabled:1
Feedback:none
ID:""
Name:BjCallButton1
PopHeight:400
PopWidth:720
Size:default
Visible:1
Position
{
Height:20
Left:21
Top:17
Width:80
}
}
}
}
BjCallArg
{
ID:input_users
IsInput:1
IsOutput:1
Name:input_users
Value:""
Position
{
Height:28
Left:36
Top:53
Width:165
}
}
}
}
BjEdit
{
BeforeCreate:""
Caption:userids
Enabled:1
ID:userids
Inline:0
IsMultiline:0
IsPassword:0
Name:userids
PlaceHolder:""
Search:0
Size:none
Value:"<% echo(string(ids)); %>"
Visible:0
Wide:none
cols:0
rows:0
Position
{
Height:20
Left:55
Top:48
Width:80
}
InfoStatus
{
Condition:""
Text:""
}
WarnStatus
{
Condition:""
Text:""
}
ErrorStatus
{
Condition:""
Text:""
}
SuccessStatus
{
Condition:""
Text:""
}
Events
{
OnSearch:""
}
Validate
{
DisplayName:""
Format:""
MaxLength:0
MustFill:0
}
}
}
}
}
}
ConditionControl
{
Action:"oRecord.roletype == const \"模型.组织.角色.角色类型.部门\""
BeforeCreate:""
Method:if
Name:ConditionControl1
Position
{
Height:157
Left:38
Top:528
Width:600
}
@
{
Box
{
AfterCreate:""
BeforeCreate:""
Caption:""
Enabled:1
ExtProp:""
ID:""
Name:Box1
TagName:""
Visible:1
Position
{
Height:116
Left:14
Top:17
Width:558
}
@
{
BjEdit
{
BeforeCreate:""
Caption:部门：
Enabled:0
ID:unitname
Inline:0
IsMultiline:0
IsPassword:0
Name:unitname
PlaceHolder:""
Search:0
Size:none
Value:"<%
var oUnit = (new dao.table(\"t_unit\")).Single(\"where id=?\",int(oRecord.unitid));
if( oUnit <> null ) echo(oUnit.name);

%>"
Visible:1
Wide:none
cols:0
rows:0
Position
{
Height:20
Left:49
Top:20
Width:80
}
InfoStatus
{
Condition:""
Text:""
}
WarnStatus
{
Condition:""
Text:""
}
ErrorStatus
{
Condition:""
Text:""
}
SuccessStatus
{
Condition:""
Text:""
}
Events
{
OnSearch:""
}
Validate
{
DisplayName:""
Format:""
MaxLength:0
MustFill:0
}
}
BjEdit
{
BeforeCreate:""
Caption:unitid
Enabled:1
ID:unitid
Inline:0
IsMultiline:0
IsPassword:0
Name:unitid
PlaceHolder:""
Search:0
Size:none
Value:"<% echo(oRecord.unitid); %>"
Visible:0
Wide:none
cols:0
rows:0
Position
{
Height:20
Left:49
Top:63
Width:80
}
InfoStatus
{
Condition:""
Text:""
}
WarnStatus
{
Condition:""
Text:""
}
ErrorStatus
{
Condition:""
Text:""
}
SuccessStatus
{
Condition:""
Text:""
}
Events
{
OnSearch:""
}
Validate
{
DisplayName:""
Format:""
MaxLength:0
MustFill:0
}
}
BjPageCall
{
AfterCreate:""
BeforeCall:"$('#input_unitid').val( $('#unitid').val() );
$('#input_unitname').val( $('#unitname').val() );"
BeforeCreate:""
CancelCall:""
Caption:""
CommitCall:"$('#unitid').val( $('#input_unitid').val() );
$('#unitname').val( $('#input_unitname').val() );"
Enabled:1
ExtProp:""
Name:BjPageCall1
TagName:span
URL:"<%echo(FixUrl(\"/iframe/selectunit.esh\"));%>"
Visible:1
Position
{
Height:89
Left:150
Top:16
Width:370
}
@
{
BjCallArg
{
ID:input_unitid
IsInput:1
IsOutput:1
Name:input_unitid
Value:""
Position
{
Height:28
Left:16
Top:4
Width:117
}
}
BjCallArg
{
ID:input_unitname
IsInput:1
IsOutput:1
Name:input_unitname
Value:""
Position
{
Height:28
Left:16
Top:43
Width:117
}
}
BjCallButton
{
AfterCreate:""
BeforeCreate:""
Caption:选择
Enabled:1
Feedback:none
ID:""
Name:BjCallButton1
PopHeight:420
PopWidth:450
Size:default
Visible:1
Position
{
Height:28
Left:146
Top:8
Width:94
}
}
}
}
}
}
}
}
ConditionControl
{
Action:"oRecord.roletype == const \"模型.组织.角色.角色类型.表达式\""
BeforeCreate:""
Method:if
Name:ConditionControl1
Position
{
Height:157
Left:38
Top:696
Width:500
}
@
{
BjEdit
{
BeforeCreate:""
Caption:动态代码：
Enabled:1
ID:""
Inline:0
IsMultiline:1
IsPassword:0
Name:code
PlaceHolder:""
Search:0
Size:none
Value:"<% echo(oRecord.code); %>"
Visible:1
Wide:none
cols:0
rows:0
Position
{
Height:20
Left:72
Top:24
Width:80
}
InfoStatus
{
Condition:""
Text:""
}
WarnStatus
{
Condition:""
Text:""
}
ErrorStatus
{
Condition:""
Text:""
}
SuccessStatus
{
Condition:""
Text:""
}
Events
{
OnSearch:""
}
Validate
{
DisplayName:""
Format:""
MaxLength:0
MustFill:0
}
}
Html
{
BeforeCreate:""
Caption:""
Code:"<p><strong>注意</strong>：代码必须包含一个名为main的模块级函数!</p>"
Name:Html1
Position
{
Height:20
Left:76
Top:61
Width:80
}
}
}
}
Box
{
AfterCreate:""
BeforeCreate:""
Caption:""
Enabled:1
ExtProp:"style=\"margin-top:10px;margin-bottom:10px\""
ID:""
Name:Box8
TagName:""
Visible:1
Position
{
Height:49
Left:50
Top:883
Width:347
}
@
{
BjButton
{
BeforeCreate:""
Block:0
ButtonType:submit
Caption:"<i class=\"icon-ok icon-white\" style=\"margin-right:5px\" ></i>提交"
Enabled:1
Feedback:danger
ID:""
Inline:1
Name:btnsubmit_oa_workrizhi
Size:default
URL:""
URLParam:""
Visible:1
Position
{
Height:20
Left:13
Top:9
Width:80
}
Events
{
OnClick:"
try
{
	

		
		if( \"\" == me._vo.name ) throw \"请输入name\";
		
			if( me._vo.name.Length >128 ) throw \"输入的数据长度超过了name的限制\";
			
			if( me._vo.desc.Length >1024 ) throw \"输入的数据长度超过了desc的限制\";
			

		
}
catch (ex)
{
	me._Errort_roleHint= string(ex);
	return;
}
var obj=
{
	\"name\"			: me._vo.name,
	\"desc\"			: me._vo.desc
};
switch( me._vo.roletype )
{
	case const \"模型.组织.角色.角色类型.群组\":
	{
		(new dao.table(\"t_role_user\")).Delete(\"roleid\",me._vo.id);
		var ax = me._vo.userids.Split(\"|\");
		each(a,ax)
		{
			if( int(a) )
			{
				(new dao.table(\"t_role_user\")).Add({\"roleid\":me._vo.id,\"userid\":int(a)});
			}
		}
		(new dao.table(\"t_role\")).Update(obj,\"id\",me._vo.id);
	}
	case const \"模型.组织.角色.角色类型.部门\":
	{
		obj.unitid = me._vo.unitid;
		(new dao.table(\"t_role\")).Update(obj,\"id\",me._vo.id);
	}
	case const \"模型.组织.角色.角色类型.表达式\":
	{
		obj.code = me._vo.code;
		(new dao.table(\"t_role\")).Update(obj,\"id\",me._vo.id);
	}
}


me._Successt_role_Hint = \"修改成功\";
"
OnClientClick:""
}
}
BjButton
{
BeforeCreate:""
Block:0
ButtonType:back
Caption:"<i class=\"icon-repeat \" style=\"margin-right:5px\" ></i>返回"
Enabled:1
Feedback:default
ID:""
Inline:1
Name:btncancel_oa_workrizhi
Size:default
URL:""
URLParam:""
Visible:1
Position
{
Height:20
Left:113
Top:11
Width:80
}
Events
{
OnClick:""
OnClientClick:""
}
}
}
}
}
}
}
}
}
}
}
}
