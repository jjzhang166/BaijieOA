BjPage
{
AdjustFrame:0
BeforeCreate:""
BodyProp:""
BootstrapVer:2
Caption:发表贴子
Enabled:1
Name:BjPage1
PageID:""
ParenClass:""
Visible:1
Workflow:""
Position
{
Height:1100
Left:63
Top:63
Width:800
}
Events
{
Def:""
OnLoad:"if( me.会话._Session.ID == \"\" ) me.ErrorAndRedirect( \"您还没有登录，登录后才能发贴\", FixUrl(\"/bbs/login.esh\") );"
}
@
{
EasyScript
{
Caption:设置一级菜单
Code:"me.ControlProp[\"一级菜单/Active\"] = \"论坛\";"
CodeType:load
Name:EasyScript1
Position
{
Height:20
Left:0
Top:-36
Width:142
}
}
UserControl
{
BeforeCreate:""
Caption:""
Enabled:1
Name:UserControl1
PathName:"/template/bbsbase.ui"
Visible:1
Position
{
Height:971
Left:46
Top:26
Width:770
}
@
{
Box
{
AfterCreate:""
BeforeCreate:""
Caption:""
Enabled:1
ExtProp:""
ID:""
Name:BBSClient
TagName:""
Visible:1
Position
{
Height:736
Left:16
Top:21
Width:736
}
@
{
Box
{
AfterCreate:""
BeforeCreate:""
Caption:""
Enabled:1
ExtProp:"style=\"margin-top:5px\""
ID:""
Name:Box2
TagName:""
Visible:1
Position
{
Height:18
Left:6
Top:9
Width:629
}
}
BjSubmitArea
{
Action:""
BeforeCreate:""
Caption:""
FileUpload:0
Horz:0
ID:""
Inline:0
Method:post
Name:t_bbs_post_submitarea
Search:0
Position
{
Height:540
Left:26
Top:37
Width:632
}
@
{
EasyScript
{
Caption:""
Code:"
public var _Errort_bbs_post_Hint=\"\";
public var _Successt_bbs_post_Hint=\"\";
"
CodeType:server
Name:esvar_t_bbs_post
Position
{
Height:20
Left:38
Top:10
Width:80
}
}
BjBreadcrumbNav
{
BeforeCreate:""
ExtProp:""
Name:BjBreadcrumbNav1
Position
{
Height:33
Left:70
Top:39
Width:516
}
@
{
BjBreadcrumb
{
Active:""
BeforeCreate:""
Caption:当前位置
Divider:：
Enabled:1
Name:BjBreadcrumb5
Visible:1
href:""
Position
{
Height:20
Left:10
Top:6
Width:80
}
}
BjBreadcrumb
{
Active:""
BeforeCreate:""
Caption:首页
Divider:"/"
Enabled:1
Name:BjBreadcrumb1
Visible:1
href:"<%echo(FixUrl(\"/default.esh\"));%>"
Position
{
Height:20
Left:137
Top:0
Width:80
}
}
BjBreadcrumb
{
Active:""
BeforeCreate:""
Caption:论坛
Divider:"/"
Enabled:1
Name:BjBreadcrumb2
Visible:1
href:"<%echo(FixUrl(\"/bbs/home.esh\"));%>"
Position
{
Height:20
Left:232
Top:0
Width:80
}
}
BjBreadcrumb
{
Active:""
BeforeCreate:""
Caption:"<% echo(oSection.name); %>"
Divider:"/"
Enabled:1
Name:BjBreadcrumb3
Visible:1
href:"<% echo(FixUrl(\"/bbs/section.esh?id=\"+oSection.id)); %>"
Position
{
Height:20
Left:331
Top:0
Width:80
}
}
BjBreadcrumb
{
Active:""
BeforeCreate:""
Caption:发表新贴
Divider:""
Enabled:1
Name:BjBreadcrumb4
Visible:1
href:""
Position
{
Height:20
Left:426
Top:0
Width:80
}
}
}
}
ConditionControl
{
Action:"me._Errort_bbs_post_Hint <> \"\""
BeforeCreate:""
Method:if
Name:errconditiont_bbs_post
Position
{
Height:80
Left:70
Top:86
Width:338
}
@
{
BjAlertBox
{
BeforeCreate:""
CanClose:1
Caption:""
Enabled:1
ID:""
Level:error
Multi:1
Name:errAlertt_bbs_post
Visible:1
Position
{
Height:60
Left:10
Top:10
Width:300
}
@
{
Html
{
BeforeCreate:""
Caption:错误提示_t_bbs_post
Code:"<% echo(me._Errort_bbs_post_Hint); %>"
Name:errHtml_t_bbs_post
Position
{
Height:20
Left:10
Top:10
Width:80
}
}
}
}
}
}
ConditionControl
{
Action:"me._Successt_bbs_post_Hint <> \"\""
BeforeCreate:""
Method:if
Name:successconditiont_bbs_post
Position
{
Height:80
Left:70
Top:183
Width:338
}
@
{
BjAlertBox
{
BeforeCreate:""
CanClose:1
Caption:""
Enabled:1
ID:""
Level:success
Multi:1
Name:successAlertt_bbs_post
Visible:1
Position
{
Height:60
Left:10
Top:10
Width:300
}
@
{
Html
{
BeforeCreate:""
Caption:成功提示_t_bbs_post
Code:"<% echo(me._Successt_bbs_post_Hint); %>"
Name:successHtml_t_bbs_post
Position
{
Height:20
Left:10
Top:10
Width:80
}
}
}
}
}
}
BjEdit
{
BeforeCreate:""
Caption:sectionid
Enabled:1
ID:""
Inline:0
IsMultiline:0
IsPassword:0
Name:sectionid
PlaceHolder:""
Search:0
Size:none
Value:"<% echo(me._vo.sectionid); %>"
Visible:0
Wide:none
cols:0
rows:0
Position
{
Height:20
Left:100
Top:285
Width:80
}
InfoStatus
{
Condition:""
Text:""
}
WarnStatus
{
Condition:""
Text:""
}
ErrorStatus
{
Condition:""
Text:""
}
SuccessStatus
{
Condition:""
Text:""
}
Events
{
OnSearch:""
}
Validate
{
DisplayName:""
Format:""
MaxLength:0
MustFill:0
}
}
BjEdit
{
BeforeCreate:""
Caption:主题：
Enabled:1
ID:""
Inline:0
IsMultiline:0
IsPassword:0
Name:title
PlaceHolder:""
Search:0
Size:none
Value:""
Visible:1
Wide:none
cols:0
rows:0
Position
{
Height:20
Left:100
Top:322
Width:80
}
InfoStatus
{
Condition:""
Text:""
}
WarnStatus
{
Condition:""
Text:""
}
ErrorStatus
{
Condition:""
Text:""
}
SuccessStatus
{
Condition:""
Text:""
}
Events
{
OnSearch:""
}
Validate
{
DisplayName:128
Format:""
MaxLength:0
MustFill:1
}
}
RichEdit
{
BeforeCreate:""
Caption:贴子内容：
Enabled:1
ID:""
Name:html
Value:""
Visible:1
Position
{
Height:92
Left:70
Top:373
Width:322
}
}
Box
{
AfterCreate:""
BeforeCreate:""
Caption:""
Enabled:1
ExtProp:"style=\"margin-top:10px\""
ID:""
Name:Box1
TagName:""
Visible:1
Position
{
Height:58
Left:70
Top:472
Width:301
}
@
{
BjButton
{
BeforeCreate:""
Block:0
ButtonType:submit
Caption:提交
Enabled:1
Feedback:primary
ID:""
Inline:1
Name:BjButton1
Size:default
URL:""
URLParam:""
Visible:1
Position
{
Height:20
Left:19
Top:16
Width:80
}
Events
{
OnClick:"
try
{
	if( \"\" == me._vo.title) throw \"请输入贴子标题!\";
		if( \"\" == me._vo.html ) throw \"贴子内容不能为空\";
		if( me._vo.html.Length > 2048 * 5 ) throw \"贴子内容太长，请分拆发表\";
		
}
catch (ex)
{
	me._Errort_bbs_post_Hint= string(ex);
	return;
}
var obj=
{
	\"userid\"			: me.会话.UserID,
	\"username\"			: me.会话.Alias,
	\"sectionid\"			: oSection.id,
	\"publishtime\"			: (new DateTime()),
	\"html\"				: me._vo.html,
	\"readcount\"			: 0,
	\"replycount\"			: 0,
	\"title\"				: me._vo.title,
	\"modifytime\"			: (new DateTime())

};
(new dao.table(\"t_bbs_subject\")).Add(obj);
me._Successt_bbs_post_Hint = \"添加成功\";
var postid=staticcall(\"dao.table.GetLastInsertID\");
redirect(FixUrl(\"/bbs/view_\"+postid+\".html\"));
"
OnClientClick:""
}
}
BjButton
{
BeforeCreate:""
Block:0
ButtonType:back
Caption:返回
Enabled:1
Feedback:default
ID:""
Inline:1
Name:BjButton2
Size:default
URL:""
URLParam:""
Visible:1
Position
{
Height:20
Left:111
Top:16
Width:80
}
Events
{
OnClick:""
OnClientClick:""
}
}
}
}
}
}
}
}
}
}
EasyScript
{
Caption:得到Section
Code:"public var oSection = (new dao.table(\"t_bbs_section\")).Single(\"where id=?\",me._vo.sectionid);"
CodeType:server
Name:EasyScript2
Position
{
Height:20
Left:178
Top:-37
Width:145
}
}
}
}
